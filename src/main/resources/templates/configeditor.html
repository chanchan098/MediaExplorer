<!DOCTYPE html>
<html lang="en">
<head>
    <!-- when using the mode "code", it's important to specify charset utf-8 -->
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link rel="stylesheet" href="bootstrap/bootstrap.min.css">
    <script src="bootstrap/bootstrap.bundle.min.js"></script>
    <link href="jsoneditor/jsoneditor.css" rel="stylesheet" type="text/css"/>
    <script src="jsoneditor/jsoneditor.min.js"></script>

    <script src="tailwindcss/index.global.js"></script>
    <script src="jquery-3.7.1.js"></script>
    <style>
        body, html {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>


<div class="container h-full ">
    <div id="stateToast" class="toast align-items-center fade hide fixed top-1/3 left-1/2 z-99 w-min! " style="transform: translate(-50%, -50%)"
         role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="1000">
        <div class="d-flex">
            <div class="toast-body">
                Success
            </div>
        </div>
    </div>

    <div class="h-full flex flex-column">
        <div class="flex flex-row py-[10px] justify-between">
            <button class="btn btn-primary" onclick="loadConfig();">Load settings</button>
            <button class="btn btn-primary" onclick="updateConfig();">Update settings</button>
        </div>
        <div id="jsoneditor" class="w-full h-full flex-1"></div>
    </div>
</div>

<script>
    // create the editor
    var container = document.getElementById("jsoneditor");
    var editor = new JSONEditor(container);

    const myToastEl = document.getElementById('stateToast')
    const myToast = bootstrap.Toast.getOrCreateInstance(myToastEl)

    // set json
    function loadConfig() {
        editor.set("");
        fetch('/config/load', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
        })
            .then(response => response.json())
            .then(data => {
                console.log('success:', data);

                editor.set(data.data);
            })
            .catch(error => {
                console.error('error:', error);
            });

        // var json = {
        //     Array: [1, 2, 3],
        //     Boolean: true,
        //     Null: null,
        //     Number: 123,
        //     Object: {a: "b", c: "d"},
        //     String: "Hello World",
        // };
        // editor.set(json);
    }

    // get json
    function updateConfig() {
        var json = editor.get();
        // alert(JSON.stringify(json, null, 2));
        var j = JSON.stringify(json)
        fetch('/config/update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: j
        })
            .then(response => response.json())
            .then(data => {
                console.log('updated:', data);
                myToast.show()
                loadConfig();
            })
            .catch(error => {
                console.error('update failed:', error);
            });

    }

    loadConfig()
</script>
</body>
</html>
